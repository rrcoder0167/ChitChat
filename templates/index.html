<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
</head>
<body>
    <div id="join-container">
        <form id="join-form" onsubmit="return join();">
            <input type="text" id="username" placeholder="Username">
            <input type="text" id="room" placeholder="Room">
            <input type="submit" value="Join">
        </form>
    </div>
    <div id="chat-container" style="display: none;">
        <div id="chat"></div>
        <form id="message-form" onsubmit="return sendMessage();">
            <input type="text" id="message" placeholder="Message">
            <input type="submit" value="Send">
        </form>
    </div>

    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        var username;
        var room;

        function join() {
            username = document.getElementById("username").value;
            room = document.getElementById("room").value;
            socket.emit('join', {'username': username, 'room': room});
            document.getElementById("join-container").style.display = "none";
            document.getElementById("chat-container").style.display = "block";
            return false;
        }

        function sendMessage() {
            var message = document.getElementById("message").value;
            socket.emit('message', {'message': message, 'room': room});
            document.getElementById("message").value = "";
            return false;
        }

        socket.on('join_message', function(data) {
            var join_message = document.createElement("div");
            join_message.innerHTML = data.username + " has joined the room";
            join_message.className = "join-message";
            document.getElementById("chat").appendChild(join_message);
        });

        socket.on('message', function(data) {
            var message = document.createElement("div");
            message.innerHTML = data.message;
            message.className = "message";
            document.getElementById("chat").appendChild(message);
        });
    </script>
</body>
</html>
